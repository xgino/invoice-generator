{% load i18n static %}
<!doctype html>
<html lang="{{ LANGUAGE_CODE }}">

<head>
    <meta charset="utf-8">
    <title>{% trans "Invoice Editor" %}</title>
    <link rel="stylesheet" href="{% static 'css/editor.css' %}">
    <script src="{% static 'js/item.js' %}"></script>
    <script>
        const csrftoken = "{{ csrf_token }}";

        async function updatePreview() {
            const data = collectInvoiceData();
            const res = await fetch("{% url 'invoice_render' %}", {
                method: "POST",
                headers: { "Content-Type": "application/json", "X-CSRFToken": csrftoken },
                body: JSON.stringify(data)
            });
            const json = await res.json();
            document.getElementById("previewFrame").srcdoc = json.html;
        }

        async function downloadPDF() {
            const data = collectInvoiceData();
            const res = await fetch("{% url 'invoice_pdf' %}", {
                method: "POST",
                headers: { "Content-Type": "application/json", "X-CSRFToken": csrftoken },
                body: JSON.stringify(data)
            });
            const blob = await res.blob();
            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "invoice.pdf";
            a.click();
        }

        document.addEventListener("DOMContentLoaded", () => {
            document.body.addEventListener("input", () => setTimeout(updatePreview, 300));
            updatePreview();
        });
    </script>
</head>

<body class="d-flex">
    <!-- Sidebar controls -->
    <aside class="sidebar">
        <button onclick="addRow()">{% trans "Add Row" %}</button>
        <button onclick="removeRow()">{% trans "Remove Row" %}</button>

        <label>{% trans "Currency" %}</label>
        <select id="currencySelect">
            <option value="EUR">EUR â‚¬</option>
            <option value="USD">USD $</option>
        </select>

        <label>{% trans "Tax" %}</label>
        <input id="taxInput" type="number" value="21"> %

        <button onclick="downloadPDF()">{% trans "Download PDF" %}</button>
    </aside>

    <!-- Invoice Preview -->
    <main class="flex-grow">
        <iframe id="previewFrame" style="width:100%;height:100vh;border:none;"></iframe>
    </main>
</body>

</html>